{{#if (eq step 1)}}
  <div class="row">
    {{form-name-description
      model=cluster
      nameRequired=true
      nameLabel='clusterNew.name.label'
      namePlaceholder='clusterNew.name.placeholder'
      descriptionPlaceholder='clusterNew.description.placeholder'
    }}
  </div>

  {{#accordion-list showExpandAll=false as |al expandFn|}}
    {{#unless isCustom}}
      {{#accordion-list-item
        title=(t 'clusterNew.rke.nodes.title')
        detail=(t 'clusterNew.rke.nodes.detail')
        showExpand=false
        expandOnInit=true
        expandAll=al.expandAll
        expand=(action expandFn)
      }}
        {{#sortable-table
          classNames="grid sortable-table"
          body=cluster.nodes
          suffix=true
          search=false
          bulkActions=false
          rowActions=false
          pagingLabel="pagination.node"
          headers=headers
          as |sortable kind node dt|
        }}
          {{#if (eq kind "row")}}
            <tr class="main-row">
              <td data-title="{{dt.name}}">
                {{node.displayName}}
              </td>
              <td data-title="{{dt.nodeTemplate}}">
                Node Template
              </td>
              <td data-title="{{dt.etcd}}" class="text-center">
                {{input type="checkbox" checked=(array-includes node.role 'etcd') change=(action 'toggleRole' node 'etcd')}}
              </td>
              <td data-title="{{dt.controlplane}}" class="text-center">
                {{input type="checkbox" checked=(array-includes node.role 'controlplane') change=(action 'toggleRole' node 'controlplane')}}
              </td>
              <td data-title="{{dt.worker}}" class="text-center">
                {{input type="checkbox" checked=(array-includes node.role 'worker') change=(action 'toggleRole' node 'worker')}}
              </td>
              <td data-title="{{dt.remove}}" class="text-center">
                <button class="btn bg-primary btn-sm" {{action "removeNode" node}}><i class="icon icon-minus"/></button>
              </td>
            </tr>
          {{else if (eq kind "norows")}}
            <tr><td colspan="{{sortable.fullColspan}}" class="text-center text-muted pt-40 pb-40">{{t 'nodesPage.table.noData'}}</td></tr>
          {{else if (eq kind "suffix")}}
            <tr class="banner bg-info suffix">
              <td colspan="2" class="pl-20 text-bold">{{t 'clusterNew.rke.role.requirements.label'}}</td>
              <td class="text-center {{if etcdSafe "text-success" "text-error text-bold"}}">
                <i class="icon {{if etcdSafe "icon-success" "icon-x-circle"}}"></i>
                {{t 'clusterNew.rke.role.requirements.etcd'}}
              </td>
              <td class="text-center {{if cpSafe "text-success" "text-error text-bold"}}">
                <i class="icon {{if cpSafe "icon-success" "icon-x-circle"}}"></i>
                {{t 'clusterNew.rke.role.requirements.controlplane'}}
              </td>
              <td class="text-center {{if workerSafe "text-success" "text-error text-bold"}}">
                <i class="icon {{if workerSafe "icon-success" "icon-x-circle"}}"></i>
                {{t 'clusterNew.rke.role.requirements.worker'}}
              </td>
              <td></td>
            </tr>
          {{/if}}
        {{/sortable-table}}

        <div class="mt-20">
          <button class="btn bg-primary icon-btn p-0" {{action "addNode"}}>
            <span class="darken"><i class="icon icon-plus text-small"/></span>
            <span>{{t 'clusterNew.rke.nodes.add'}}</span>
          </button>
        </div>
      {{/accordion-list-item}}
    {{/unless}}

    {{#accordion-list-item
      title=(t 'clusterNew.rke.config.label')
      detail=(t 'clusterNew.rke.config.detail')
      expandAll=al.expandAll
      expand=(action expandFn)
    }}
      <div class="row">
        <div class="col span-6">
          <label class="acc-label">{{t 'clusterNew.rke.version.label'}}</label>
          {{new-select
              classNames="form-control"
              content=versionChoices
              localizedLabel=true
              value=config.version
              disabled=true
          }}
        </div>
        <div class="col span-6">
          <label class="acc-label">{{t 'clusterNew.rke.network.label'}}</label>
          {{new-select
              classNames="form-control"
              content=networkChoices
              localizedLabel=true
              value=config.network.plugin
          }}
        </div>
      </div>
    {{/accordion-list-item}}

    {{#accordion-list-item
      title=(t 'clusterNew.rke.customize.label')
      detail=(t 'clusterNew.rke.customize.detail')
      expandAll=al.expandAll
      expand=(action expandFn)
    }}
      <div class="row">
        <div class="col span-6">
          <label class="acc-label">{{t 'clusterNew.rke.registry.label'}}</label>
          <div class="radio">
            <label>
              {{radio-button selection=registry value="default"}}
              {{t 'clusterNew.rke.registry.default'}}
            </label>
          </div>
          <div class="radio">
            <label>
              {{radio-button selection=registry value="custom"}}
              {{t 'clusterNew.rke.registry.custom'}}
            </label>
          </div>
          {{#if (eq registry 'custom')}}
            <label class="acc-label">{{t 'clusterNew.rke.registry.url.label'}}</label>
            {{input type="text" value=registryUrl}}
            <label class="acc-label">{{t 'clusterNew.rke.registry.user.label'}}</label>
            {{input type="text" value=registryUser}}
            <label class="acc-label">{{t 'clusterNew.rke.registry.password.label'}}</label>
            {{input type="password" value=registryPassword}}
          {{/if}}
        </div>

        <div class="col span-6">
          <label class="acc-label">{{t 'clusterNew.rke.ignoreDockerVersion.label'}}</label>
          <div class="radio">
            <label>
              {{radio-button selection=config.ignoreDockerVersion value=false}}
              {{t 'clusterNew.rke.ignoreDockerVersion.disabled'}}
            </label>
          </div>
          <div class="radio">
            <label>
              {{radio-button selection=config.ignoreDockerVersion value=true}}
              {{t 'clusterNew.rke.ignoreDockerVersion.enabled'}}
            </label>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col span-6">
          <label class="acc-label">{{t 'clusterNew.rke.psp.label'}}</label>
          {{form-pod-sec-policy
              config=secPolicy
              policies=model.policies
          }}
        </div>
      </div>
    {{/accordion-list-item}}

    {{#accordion-list-item
      title=(t 'clusterNew.members.label')
      detail=(t 'clusterNew.members.detail')
      expandAll=al.expandAll
      expand=(action expandFn)
    }}
      {{form-members
          editing=true
          memberConfig=memberConfig
          primaryResource=primaryResource
          creator=model.me
          roles=model.roleTemplates
          users=model.users
          type="cluster"
          registerHook=(action "registerHook")
      }}
    {{/accordion-list-item}}

  {{/accordion-list}}

  {{top-errors errors=errors}}
  {{save-cancel createLabel=(if isCustom 'saveCancel.next' 'saveCancel.create') save="save" cancel=cancel}}
{{else}}

  {{#accordion-list showExpandAll=false as |al expandFn|}}
    {{#accordion-list-item
      title=(t 'clusterNew.rke.role.title')
      detail=(t 'clusterNew.rke.role.detail')
      expandOnInit=true
      expandAll=al.expandAll
      expand=(action expandFn)
    }}
      <div class="row">
        <div class="col span-4 text-center">
          <label>{{input type="checkbox" checked=etcd}} {{t 'clusterNew.rke.role.header.etcd'}}</label>
        </div>
        <div class="col span-4 text-center">
          <label>{{input type="checkbox" checked=controlplane}} {{t 'clusterNew.rke.role.header.controlplane'}}</label>
        </div>
        <div class="col span-4 text-center">
          <label>{{input type="checkbox" checked=worker}} {{t 'clusterNew.rke.role.header.worker'}}</label>
        </div>
      </div>
    {{/accordion-list-item}}

    {{form-user-labels
      setLabels=(action 'setLabels')
      expandAll=al.expandAll
      expand=(action expandFn)
      detailKey="formUserLabels.nodeDetail"
    }}
  {{/accordion-list}}

  <div class="copy-pre mt-20 mb-20">
    {{copy-to-clipboard clipboardText=command tagName="div" classNames="copy-to-pre"}}
    <pre id="registration-command" style="font-size: 14px;">{{command}}</pre>
  </div>

  <div class="mt-20">
    {{t 'clusterNew.rke.command.instructions'
      appName=settings.appName
      docsBase=settings.docsBase
      htmlSafe=true
    }}
  </div>

  {{#if newNodeCount}}
    <div class="banner bg-success">
      <div class="banner-icon"><span class="icon icon-success"></span></div>
      <div class="banner-message">
        <p>{{t 'clusterNew.custom.detected' count=newNodeCount}}</p>
      </div>
    </div>
  {{/if}}

  <div class="footer-actions">
    <button {{action "close"}} class="btn bg-primary">{{t 'generic.closeModal'}}</button>
  </div>
{{/if}}
